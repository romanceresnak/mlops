name: Deploy Infrastructure - Production

on: 
  workflow_dispatch:

jobs:
  terraform-deploy:
    uses: ./.github/workflows/terraform-infrastructure-deploy.yml
    with:
      TFAction: 'apply'
      dply_environment: 'prod'  
      location: 'westeurope'
      namespace: 'mlopslite'
      postfix: 'rc'
      environment: 'prod'
      enable_aml_computecluster: true
      enable_monitoring: false
      terraform_version: '0.14.7'
      terraform_workingdir: './infrastructure'
      terraform_st_location: 'westeurope'
      terraform_st_storage_account: 'sttfstateao04'
      terraform_st_resource_group: 'my-tf-state-rg'
      terraform_st_container_name: 'default'
      terraform_st_key: 'mlops-tab'
      terraform_plan_location: 'westeurope'
      terraform_plan_vnet: "TBD"
    secrets:
      azure_creds: ${{ secrets.AZURE_CREDENTIALS }}
      clientId: ${{ secrets.ARM_CLIENT_ID }}
      clientSecret: ${{ secrets.ARM_CLIENT_SECRET }}
      subscriptionId: ${{ secrets.ARM_SUBSCRIPTION_ID }}
      tenantId: ${{ secrets.ARM_TENANT_ID }}